"use strict";(self.webpackChunkmaps=self.webpackChunkmaps||[]).push([[194],{2581:(e,t,o)=>{o.r(t),o.d(t,{default:()=>z});var n=o(9950),r=o(9810),s=o(9029),a=o(7113),i=o(8513),l=o(8843),c=o(2527),d=o.n(c),p=(o(5392),o(7024)),u=o(1071),h=o(8007);const g=e=>{let{onClick:t}=e;return(0,h.Po)({click:e=>{t(e)}}),null};var m=o(5524),x=o(8429),k=o(3507),C=o(5138),j=o(7119);const b="modal_wrapper__EfZCv";var v=o(4414);const f=e=>{let{children:t,handleClose:o}=e;return j.createPortal((0,v.jsx)("div",{onClick:e=>{e.target===e.currentTarget&&o()},className:b,children:t}),document.getElementById("modal-root"))},w=async(e,t,o)=>{const n=await fetch(`${m.A}/api/markers/${e}`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok)return!0;throw new Error(n.status)};var A=o(1299),S=o(1714);const y=e=>{let{point:t,handleClose:o}=e;const[r,s]=(0,n.useState)(!1),[a,i]=(0,n.useState)(""),{token:l}=(0,k.A)(),{region:c}=(0,x.g)();return(0,v.jsxs)(f,{handleClose:o,children:[(0,v.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!t||a.trim().length<5||!c)return void S.oR.error("Check description field");const n={coordinate:{latitude:t[0],longitude:t[1]},description:a};try{s(!0),await w(c,n,l),S.oR.success("Success"),setTimeout((()=>{o()}),1500)}catch(r){S.oR.error("Error"),s(!1)}},className:"bg-white p-4 relative",children:[(0,v.jsx)("button",{className:"absolute top-1 right-2 font-bold",onClick:o,children:"X"}),(0,v.jsx)("p",{className:"font-bold text-center text-xl mb-2",children:"Add marker"}),(0,v.jsx)("input",{className:"border-[1px] border-black mb-5 p-4",type:"text",value:a,onChange:e=>i(e.target.value),placeholder:"Description "}),(0,v.jsx)(A.A,{type:"submit",title:"Add marker",disabled:!!(a.trim().length<5||r),children:"Add marker"})]}),(0,v.jsx)(S.N9,{position:"top-right",autoClose:1e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"dark"})]})},O=new(d().Icon)({iconUrl:p,shadowUrl:u,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),N=()=>{const e=(0,x.zy)(),{region:t}=(0,x.g)(),{token:o}=(0,k.A)(),[c,d]=(0,n.useState)(null),[p,u]=(0,n.useState)([]),[h]=(0,n.useState)((()=>{const e=C.A.find((e=>e.track===t));return e||null})),[j,b]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{if(!e.state||!h)return;const n=new l.G(`${m.A}/api/markers/${t}`,{headers:{Authorization:`Bearer ${o}`,Connection:"keep-alive","Content-Type":"application/json","Cache-Control":"no-cache","Access-Control-Allow-Origin":"*"}});n.onopen=()=>S.oR.success("Connection open"),n.onmessage=e=>{if("message"===e.type){const t=JSON.parse(e.data);u(t)}},n.onerror=()=>S.oR.error("Oops, something went wrong");const r=e=>{const t=JSON.parse(e.data);u((e=>[...e,t]))};return n.addEventListener("updates",r),()=>{n.removeEventListener(r),n.close()}}),[t,o,e,h]),e.state&&h?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(r.W,{center:[h.latitude,h.longitude],zoom:10,style:{height:"100vh",width:"100%"},children:[(0,v.jsx)(s.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xa9 OpenStreetMap contributors"}),(0,v.jsx)(g,{onClick:e=>{const{latlng:t}=e;d([t.lat,t.lng]),b(!0)}}),p.map((e=>(0,v.jsx)(a.p,{position:[e.coordinate.latitude,e.coordinate.longitude],icon:O,children:(0,v.jsx)(i.z,{children:(0,v.jsx)("div",{children:e.description})})},e._id))),c&&(0,v.jsx)(a.p,{position:c,icon:O})]}),j&&(0,v.jsx)(y,{point:c,handleClose:()=>b(!1)}),(0,v.jsx)(S.N9,{position:"top-right",autoClose:1e3,hideProgressBar:!0,newestOnTop:!1,closeButton:!1,closeOnClick:!0,rtl:!1,draggable:!0,pauseOnHover:!0,theme:"dark"})]}):(0,v.jsx)(x.C5,{to:"/regions"})},z=()=>(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(N,{})})}}]);